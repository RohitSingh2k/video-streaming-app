const url=window.location.origin,baseUrl=url.endsWith("/")?url.substr(0,url.lastIndexOf("/")):url,source=document.querySelector("#source"),titleHead=document.querySelector("#title"),videoPlayer=document.querySelector("#videoPlayer"),thumbnailList=document.querySelector("#videoList"),dropContainer=document.querySelector("#drop-container");function uploadFiles(e){var t=new FormData;t.append("file1",e.files[0]),fetch(baseUrl+"/upload",{method:"post",body:t}).then(e=>{e.ok?alert("File uploaded successfully!"):alert("Unable to upload the files."+e.status),dropContainer.classList.remove("hover"),refreshVideosList()}).catch(e=>console.log(e))}function refreshVideosList(){fetch(baseUrl+"/videos").then(e=>e.ok?e.json().then(e=>e):[]).then(e=>{0<e.length&&(removeChilds(thumbnailList),e.forEach(({title:e,thumbnail:t,url:r})=>{addVideo(e,""+baseUrl+t,""+baseUrl+r)}),addEvents())}).catch(e=>console.error(e))}function addEvents(){[...document.getElementsByClassName("video-item")].forEach(e=>{e.addEventListener("click",e=>{var e=e.target,t=e.getAttribute("data-title"),e=e.getAttribute("data-video");titleHead.innerHTML=t,videoPlayer.pause(),source.src=e,videoPlayer.load(),videoPlayer.play()})})}function addVideo(e,t,r){var a=document.createElement("li"),o=document.createElement("img");o.setAttribute("width","150"),o.setAttribute("height","100"),o.setAttribute("src",t),o.setAttribute("alt","thumbnail"),o.classList.add("video-item"),o.dataset.video=r,o.dataset.title=e,a.appendChild(o),thumbnailList.appendChild(a)}function removeChilds(e){for(;e.lastChild;)e.removeChild(e.lastChild)}dropContainer.addEventListener("dragover",e=>{e.preventDefault(),dropContainer.classList.add("hover")}),dropContainer.addEventListener("dragleave",e=>{e.preventDefault(),dropContainer.classList.remove("hover")}),dropContainer.addEventListener("drop",e=>{e.preventDefault();var t=new DataTransfer;for(const r of e.dataTransfer.files)"video/mp4"===r.type&&t.items.add(r);0<t.items.length&&uploadFiles(t)});